<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Progressive 3D Solar Neighborhood</title>
  <style>
    :root {
      color-scheme: dark;
      --panel-bg: rgba(10, 12, 26, 0.75);
      --accent: #7ddcff;
      --accent-2: #c5a3ff;
      --text: #e9f3ff;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(60, 80, 140, 0.1), transparent 50%),
                  radial-gradient(circle at 80% 10%, rgba(255, 180, 90, 0.08), transparent 45%),
                  #050814;
      color: var(--text);
      overflow: hidden;
    }

    canvas { display: block; }

    .ui {
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: 12px;
      gap: 12px;
    }

    .panel {
      pointer-events: auto;
      backdrop-filter: blur(12px);
      background: var(--panel-bg);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.35);
    }

    header.panel {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: 0.5px;
    }

    .legend {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 12px;
    }

    .legend span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .legend b {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .control-panel {
      max-width: 420px;
      display: grid;
      gap: 10px;
      align-content: start;
    }

    .row { display: grid; gap: 6px; }
    .row label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; color: #a9b4d7; }
    .row input[type="range"] { width: 100%; }

    .row button {
      width: 100%;
      padding: 10px 12px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #0a0d1a;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .row button:hover { transform: translateY(-1px); box-shadow: 0 10px 25px rgba(0,0,0,0.35); }
    .row button:active { transform: translateY(0); }

    .note {
      font-size: 12px;
      color: #9db5d2;
      line-height: 1.5;
    }

    footer.panel { display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: #9db5d2; }
  </style>
</head>
<body>
  <div id="app"></div>
  <div class="ui">
    <header class="panel">
      <div>
        <h1>Progressive Solar Neighborhood</h1>
        <div class="legend">
          <span><b style="background:#ffdd33"></b>Sun</span>
          <span><b style="background:#2ec5ff"></b>Planets</span>
          <span><b style="background:#c587ff"></b>Moons &amp; rings</span>
          <span><b style="background:#ff8f66"></b>Nearby stars</span>
          <span><b style="background:#7df5c9"></b>Galactic plane</span>
        </div>
      </div>
    </header>

    <div class="panel control-panel">
      <div class="row">
        <label for="zoom">Perspective</label>
        <input type="range" id="zoom" min="0" max="1" step="0.001" value="0" />
        <div class="note" id="zoomLabel">Inner Solar System</div>
      </div>
      <div class="row">
        <button id="play">▶ Auto zoom out</button>
      </div>
      <div class="note">
        Drag to orbit, scroll to zoom manually. The slider steps through scales: inner planets → gas giants → Oort cloud → nearby stars → Milky Way.
      </div>
    </div>

    <footer class="panel">Scale is heavily compressed; distances are relative for clarity.</footer>
  </div>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js";
    import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/controls/OrbitControls.js";

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.8));
    document.getElementById("app").appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x02040d, 0.0006);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 200000);
    camera.position.set(0, 15, 80);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    const light = new THREE.PointLight(0xffffff, 2.2, 0, 2);
    light.position.set(0, 0, 0);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x6aa1ff, 0.2));

    const celestial = [];
    const createSphere = (radius, color, position, emissive = 0x000000) => {
      const mat = new THREE.MeshStandardMaterial({ color, emissive, roughness: 0.6, metalness: 0.1 });
      const geo = new THREE.SphereGeometry(radius, 48, 32);
      const mesh = new THREE.Mesh(geo, mat);
      mesh.position.copy(position);
      scene.add(mesh);
      return mesh;
    };

    // Sun
    const sun = createSphere(6, 0xffdd33, new THREE.Vector3(0, 0, 0), 0xffbb33);
    celestial.push({ mesh: sun, min: 0 });

    const planets = [
      { name: "Mercury", distance: 12, size: 0.9, color: 0xb3b3b3, min: 0 },
      { name: "Venus", distance: 17, size: 1.2, color: 0xffd6a5, min: 0 },
      { name: "Earth", distance: 23, size: 1.3, color: 0x2ec5ff, min: 0 },
      { name: "Mars", distance: 30, size: 1.0, color: 0xff8f66, min: 0 },
      { name: "Jupiter", distance: 45, size: 3.5, color: 0xd9b38c, min: 0.18 },
      { name: "Saturn", distance: 60, size: 3, color: 0xf1d49a, min: 0.25 },
      { name: "Uranus", distance: 72, size: 2.2, color: 0x9adedb, min: 0.32 },
      { name: "Neptune", distance: 82, size: 2.1, color: 0x6fa7ff, min: 0.35 },
    ];

    planets.forEach((p) => {
      const mesh = createSphere(p.size, p.color, new THREE.Vector3(p.distance, 0, 0));
      mesh.userData = { name: p.name };
      celestial.push({ mesh, min: p.min });
    });

    // Earth's moon
    const moon = createSphere(0.4, 0xcfcfd1, new THREE.Vector3(26, 0, 0));
    celestial.push({ mesh: moon, min: 0.05 });

    // Saturn rings
    const ringGeo = new THREE.RingGeometry(4.5, 6.2, 64);
    const ringMat = new THREE.MeshBasicMaterial({ color: 0xdcc8a3, side: THREE.DoubleSide, transparent: true, opacity: 0.75 });
    const rings = new THREE.Mesh(ringGeo, ringMat);
    rings.rotation.x = Math.PI / 2.4;
    rings.position.x = 60;
    scene.add(rings);
    celestial.push({ mesh: rings, min: 0.25 });

    // Orbit paths for readability
    const orbits = new THREE.Group();
    planets.forEach((p) => {
      const circle = new THREE.RingGeometry(p.distance - 0.1, p.distance + 0.1, 128);
      const mat = new THREE.MeshBasicMaterial({ color: 0x4b5a7f, side: THREE.DoubleSide, transparent: true, opacity: 0.45 });
      const ring = new THREE.Mesh(circle, mat);
      ring.rotation.x = Math.PI / 2;
      orbits.add(ring);
    });
    scene.add(orbits);
    celestial.push({ mesh: orbits, min: 0.12 });

    // Asteroid belt hint
    const beltGeo = new THREE.RingGeometry(34, 40, 128, 2, 0, Math.PI * 2);
    const beltMat = new THREE.MeshBasicMaterial({ color: 0xa7b4d5, transparent: true, opacity: 0.18, side: THREE.DoubleSide });
    const belt = new THREE.Mesh(beltGeo, beltMat);
    belt.rotation.x = Math.PI / 2;
    scene.add(belt);
    celestial.push({ mesh: belt, min: 0.12 });

    // Oort cloud glow
    const oortGeo = new THREE.SphereGeometry(180, 32, 16);
    const oortMat = new THREE.MeshBasicMaterial({ color: 0x8ad0ff, transparent: true, opacity: 0.06, wireframe: false });
    const oort = new THREE.Mesh(oortGeo, oortMat);
    scene.add(oort);
    celestial.push({ mesh: oort, min: 0.55 });

    // Nearby stars
    const nearbyStars = new THREE.Group();
    const neighbors = [
      { name: "Proxima Centauri", distance: 260, color: 0xff8f66 },
      { name: "Alpha Centauri A", distance: 262, color: 0xffd6a5 },
      { name: "Alpha Centauri B", distance: 264, color: 0xffb782 },
      { name: "Barnard's Star", distance: 290, color: 0xffa07f },
      { name: "Sirius", distance: 350, color: 0xffffff },
    ];
    neighbors.forEach((star, i) => {
      const phi = (i / neighbors.length) * Math.PI * 2;
      const mesh = createSphere(2, star.color, new THREE.Vector3(Math.cos(phi) * star.distance, 0, Math.sin(phi) * star.distance));
      nearbyStars.add(mesh);
    });
    scene.add(nearbyStars);
    celestial.push({ mesh: nearbyStars, min: 0.65 });

    // Galactic plane
    const galaxyGeo = new THREE.RingGeometry(600, 900, 64, 1);
    const galaxyMat = new THREE.MeshBasicMaterial({ color: 0x7df5c9, transparent: true, opacity: 0.06, side: THREE.DoubleSide });
    const galaxy = new THREE.Mesh(galaxyGeo, galaxyMat);
    galaxy.rotation.x = Math.PI / 2.5;
    scene.add(galaxy);
    celestial.push({ mesh: galaxy, min: 0.82 });

    // Starfield
    const starGeo = new THREE.BufferGeometry();
    const starCount = 2000;
    const positions = new Float32Array(starCount * 3);
    for (let i = 0; i < starCount; i++) {
      const r = THREE.MathUtils.randFloat(150, 1200);
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.acos(THREE.MathUtils.randFloatSpread(2));
      positions[i * 3] = r * Math.sin(phi) * Math.cos(theta);
      positions[i * 3 + 1] = r * Math.cos(phi) * 0.4; // flatten slightly to hint at galactic disk
      positions[i * 3 + 2] = r * Math.sin(phi) * Math.sin(theta);
    }
    starGeo.setAttribute("position", new THREE.BufferAttribute(positions, 3));
    const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.9, transparent: true, opacity: 0.8 });
    const stars = new THREE.Points(starGeo, starMat);
    scene.add(stars);
    celestial.push({ mesh: stars, min: 0.5 });

    const zoomSlider = document.getElementById("zoom");
    const zoomLabel = document.getElementById("zoomLabel");
    const playButton = document.getElementById("play");

    const stages = [
      { t: 0, label: "Inner Solar System", camera: 80 },
      { t: 0.18, label: "Gas giants come into view", camera: 140 },
      { t: 0.35, label: "Outer planets and the heliosphere", camera: 220 },
      { t: 0.55, label: "Oort cloud boundary", camera: 320 },
      { t: 0.7, label: "Nearest stellar neighbors", camera: 500 },
      { t: 1, label: "Context within the Milky Way disk", camera: 1200 },
    ];

    const lerp = (a, b, t) => a + (b - a) * t;

    function updateFromSlider(t) {
      // camera placement
      const nearStage = stages.find((s) => s.t >= t) || stages[stages.length - 1];
      const prevStage = [...stages].reverse().find((s) => s.t <= t) || stages[0];
      const stageSpan = nearStage.t - prevStage.t || 1;
      const stageT = (t - prevStage.t) / stageSpan;
      const distance = lerp(prevStage.camera, nearStage.camera, stageT);
      camera.position.set(0, lerp(10, 150, t), distance);
      zoomLabel.textContent = `${nearStage.label}`;

      // visibility gating
      celestial.forEach(({ mesh, min }) => {
        mesh.visible = t >= min - 0.02; // small hysteresis
      });

      renderer.setClearColor(new THREE.Color(lerp(0x050814, 0x010307, t)));
    }

    let autoPlay = false;
    let autoTime = 0;
    playButton.addEventListener("click", () => {
      autoPlay = !autoPlay;
      autoTime = parseFloat(zoomSlider.value);
      playButton.textContent = autoPlay ? "⏸ Pause auto zoom" : "▶ Auto zoom out";
    });

    zoomSlider.addEventListener("input", (e) => {
      const t = parseFloat(e.target.value);
      autoTime = t;
      updateFromSlider(t);
    });

    function animate() {
      requestAnimationFrame(animate);
      if (autoPlay) {
        autoTime = Math.min(1, autoTime + 0.0006 * (1 + autoTime));
        if (autoTime >= 1) autoPlay = false;
        zoomSlider.value = autoTime.toFixed(3);
        updateFromSlider(autoTime);
      }

      // gentle rotations
      sun.rotation.y += 0.002;
      planets.forEach((p, i) => {
        const angle = performance.now() * 0.0001 * (1 + i * 0.1);
        const mesh = celestial[1 + i].mesh; // offset: sun is index 0
        mesh.position.x = Math.cos(angle) * p.distance;
        mesh.position.z = Math.sin(angle) * p.distance;
      });
      moon.position.x = celestial[3].mesh.position.x + Math.cos(performance.now() * 0.0018) * 3;
      moon.position.z = celestial[3].mesh.position.z + Math.sin(performance.now() * 0.0018) * 3;

      controls.update();
      renderer.render(scene, camera);
    }

    updateFromSlider(0);
    animate();

    window.addEventListener("resize", () => {
      const { innerWidth: w, innerHeight: h } = window;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    });
  </script>
</body>
</html>
